<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="${post.title}">Post Details</title>
</head>
<body>
<nav data-th-replace="~{fragments/navBar :: navBarFragment}"></nav>
<div class="container mt-5">
  <h1 th:text="${post.title}">Post Title</h1>
  <p th:text="${#dates.format(post.createdAt, 'yyyy-MM-dd')}">Date</p>
  <div>
    <span th:each="tag : ${post.tags}" class="badge bg-secondary" th:text="${tag.name}">Tag</span>
  </div>
  <p th:text="${post.content}">Post content</p>
  <div>
    <button class="btn btn-outline-primary reactButton" th:data-post-id="${post.id}" th:data-reaction-type="LIKE">
      <i class="fas fa-thumbs-up"></i> Like <span th:text="${post.reactionsCount.LIKE}">0</span>
    </button>
    <button class="btn btn-outline-danger reactButton" th:data-post-id="${post.id}" th:data-reaction-type="DISLIKE">
      <i class="fas fa-thumbs-down"></i> Dislike <span th:text="${post.reactionsCount.DISLIKE}">0</span>
    </button>
    <!-- Add more reaction buttons similarly -->
  </div>

  <h3>Comments</h3>
  <div class="list-group">
    <div class="list-group-item" th:each="comment : ${post.comments}">
      <p th:text="${comment.content}">Comment content</p>
      <div>
        <button class="btn btn-link replyButton" th:data-comment-id="${comment.id}">Reply</button>
        <button class="btn btn-outline-primary reactButton" th:data-comment-id="${comment.id}" th:data-reaction-type="LIKE">
          <i class="fas fa-thumbs-up"></i> Like <span th:text="${comment.reactionsCount.LIKE}">0</span>
        </button>
        <button class="btn btn-outline-danger reactButton" th:data-comment-id="${comment.id}" th:data-reaction-type="DISLIKE">
          <i class="fas fa-thumbs-down"></i> Dislike <span th:text="${comment.reactionsCount.DISLIKE}">0</span>
        </button>
      </div>
      <div th:if="${comment.replies}">
        <div class="ml-4" th:each="reply : ${comment.replies}">
          <p th:text="${reply.content}">Reply content</p>
          <button class="btn btn-link replyButton" th:data-comment-id="${reply.id}">Reply</button>
          <button class="btn btn-outline-primary reactButton" th:data-comment-id="${reply.id}" th:data-reaction-type="LIKE">
            <i class="fas fa-thumbs-up"></i> Like <span th:text="${reply.reactionsCount.LIKE}">0</span>
          </button>
          <button class="btn btn-outline-danger reactButton" th:data-comment-id="${reply.id}" th:data-reaction-type="DISLIKE">
            <i class="fas fa-thumbs-down"></i> Dislike <span th:text="${reply.reactionsCount.DISLIKE}">0</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <form id="commentForm" class="mt-4">
    <div class="form-group">
      <label for="commentContent">Add a Comment</label>
      <textarea id="commentContent" class="form-control" rows="3"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</div>

<script>
  $(document).ready(function () {
    $('#commentForm').submit(function (event) {
      event.preventDefault();
      const commentData = {
        content: $('#commentContent').val(),
        postId: /* Get post ID dynamically, e.g., from a hidden field */
      };

      $.ajax({
        type: 'POST',
        url: '/comments',
        data: JSON.stringify(commentData),
        contentType: 'application/json',
        success: function () {
          alert('Comment added successfully!');
          window.location.reload(); // Reload to show the new comment
        },
        error: function (error) {
          alert('Error adding comment: ' + error.responseText);
        }
      });
    });

    $('.reactButton').click(function () {
      const reactionData = {
        type: $(this).data('reaction-type'),
        postId: $(this).data('post-id'),
        commentId: $(this).data('comment-id') || null
      };

      $.ajax({
        type: 'POST',
        url: '/reactions',
        data: JSON.stringify(reactionData),
        contentType: 'application/json',
        success: function () {
          alert('Reaction added successfully!');
          window.location.reload(); // Optionally update UI without reloading
        },
        error: function (error) {
          alert('Error adding reaction: ' + error.responseText);
        }
      });
    });

    $('.replyButton').click(function () {
      const commentId = $(this).data('comment-id');
      // Handle reply action (e.g., open reply form dynamically)
    });
  });
</script>
</body>
</html>
